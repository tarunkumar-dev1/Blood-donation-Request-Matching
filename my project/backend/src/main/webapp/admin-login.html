<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Admin Login - Blood Donation</title>
	<link rel="stylesheet" href="css/style.css" />
	<style>
		body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
		.login-container { background: white; padding: 50px; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 450px; }
		.login-header { text-align: center; margin-bottom: 40px; }
		.login-header h1 { margin: 0 0 10px 0; color: #333; font-size: 2em; }
		.login-header p { margin: 0; color: #666; font-size: 0.95em; }
		.login-icon { font-size: 3em; margin-bottom: 15px; }
		.form-group { margin-bottom: 20px; }
		.form-group label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 0.95em; }
		.form-group input { width: 100%; padding: 12px 15px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1em; transition: all 0.3s; box-sizing: border-box; }
		.form-group input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
		.login-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
		.login-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
		.login-btn:active { transform: translateY(0); }
		.error-message { background: #fef2f2; color: #991b1b; padding: 12px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ef4444; display: none; }
		.success-message { background: #f0fdf4; color: #166534; padding: 12px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #10b981; display: none; }
		.login-footer { text-align: center; margin-top: 25px; padding-top: 25px; border-top: 1px solid #e5e7eb; }
		.login-footer a { color: #667eea; text-decoration: none; font-weight: 600; }
		.login-footer a:hover { text-decoration: underline; }
		.loading { display: none; }
		.spinner { border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid white; width: 20px; height: 20px; animation: spin 1s linear infinite; margin: 0 auto; }
		@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
	</style>
</head>
<body>
	<div class="login-container">
		<div class="login-header">
			<div class="login-icon">üîê</div>
			<h1>Admin Login</h1>
			<p>Blood Donation Management System</p>
		</div>

		<div id="errorMessage" class="error-message"></div>
		<div id="successMessage" class="success-message"></div>

		<form id="adminLoginForm" onsubmit="handleLogin(event)">
			<div class="form-group">
				<label for="username">Username</label>
				<input type="text" id="username" name="username" placeholder="Enter your username" required autofocus />
			</div>

			<div class="form-group">
				<label for="password">Password</label>
				<input type="password" id="password" name="password" placeholder="Enter your password" required />
			</div>

			<button type="submit" class="login-btn" id="loginBtn">
				<span id="loginText">Sign In</span>
				<div class="loading" id="loadingSpinner">
					<div class="spinner"></div>
				</div>
			</button>
		</form>

		<div class="login-footer">
			<p>Only authorized admins can access</p>
			<a href="index.html">‚Üê Back to Home</a>
		</div>
	</div>

	<script>
		async function handleLogin(event) {
			event.preventDefault();
			
			const username = document.getElementById('username').value;
			const password = document.getElementById('password').value;
			const errorMsg = document.getElementById('errorMessage');
			const successMsg = document.getElementById('successMessage');
			const loginBtn = document.getElementById('loginBtn');
			const loginText = document.getElementById('loginText');
			const spinner = document.getElementById('loadingSpinner');

			// Clear messages
			errorMsg.style.display = 'none';
			successMsg.style.display = 'none';

			// Show loading
			loginBtn.disabled = true;
			loginText.style.display = 'none';
			spinner.style.display = 'block';

			try {
				const response = await fetch('/api/admin/login', {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: new URLSearchParams({ username, password })
				});

				const data = await response.json();

				if (response.ok && data.success) {
					successMsg.textContent = '‚úì Login successful! Redirecting...';
					successMsg.style.display = 'block';
					setTimeout(() => {
						window.location.href = 'admin.html';
					}, 1000);
				} else {
					errorMsg.textContent = '‚úó ' + (data.error || 'Invalid credentials');
					errorMsg.style.display = 'block';
					loginBtn.disabled = false;
					loginText.style.display = 'block';
					spinner.style.display = 'none';
				}
			} catch (error) {
				errorMsg.textContent = '‚úó Login error: ' + error.message;
				errorMsg.style.display = 'block';
				loginBtn.disabled = false;
				loginText.style.display = 'block';
				spinner.style.display = 'none';
			}
		}

		// Check if already logged in
		document.addEventListener('DOMContentLoaded', async () => {
			try {
				const response = await fetch('/api/admin/check-session');
				const data = await response.json();
				if (data.loggedIn) {
					window.location.href = 'admin.html';
				}
			} catch (error) {
				// Continue with login page
			}
		});
	</script>
</body>
</html>
